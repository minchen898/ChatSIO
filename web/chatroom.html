<html>
<head>
  <script src="https://cdn.socket.io/socket.io-1.1.0.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script type="text/javascript">
    var socket = io.connect('http://54.68.166.236:8002/'
      , {'sync disconnect on unload': true });
    socket.on('deliver', appendNewMessage);
    socket.on('member_join', memberJoin);
    socket.on('member_leave', memberLeave);

    $(document).ready(function() {
      $('#divSendMessage').hide();
      $('#btnJoin').click(join);
      $('#btnSend').click(sendMessage);
      $('#textInputMessage').keypress(inputMessageKeypress);
    });

    function inputMessageKeypress(e) {
      if(e.keyCode == 13) {
        if(!e.shiftKey) {
          sendMessage();
          return false;
        }
      }
    }

    function join() {
      socket.emit('join', $('#textName').val());

      $('#btnJoin').hide();
      $('#divSendMessage').show();
    }

    function memberJoin(name) {
      appendNewMessage(name + ' join the chat.')
    }

    function memberLeave(name) {
      appendNewMessage(name + ' leave the chat.')
    }

    function sendMessage() {
      socket.emit('message', $('#textInputMessage').val());
      $('#textInputMessage').val('');
    }

    function appendNewMessage(newMessage) {
      var textarea = $('#textMessages');
      textarea.val(textarea.val() + '\n' + newMessage);
      textarea.scrollTop(textarea[0].scrollHeight - textarea.height());
    };

  </script>
</head>
<body>
  <div>
    <input type="text" id="textName"></input>
    <input type="button" id="btnJoin" value="Join"></input>
  </div>
  <div>
    <textarea id="textMessages" style="height: 200px; width: 600px;"></textarea>
  </div>
  <div id="divSendMessage">
    <textarea id="textInputMessage" style="height: 80px; width: 550px;"></textarea>
    <input type="button" id="btnSend" value="Send"></input>
  </div>
</body>
</html>
